{% load i18n %}


{# z-index important for trumbowyg, set higher if not enough #}
<div id="qrpresenter" class="w3-modal" style="height:100%; z-index:100">
  <div class="w3-modal-content">
    <header class="w3-container w3-teal">
      <span onclick="close_qrmodal(); return false;"
      class="w3-button w3-display-topright">&times;</span>
      <h2>{% trans "QR/Export-Mode" %}</h2>
    </header>
    <div class="w3-container">
      <canvas id="qrcanvas"></canvas>
    </div>
    <div class="w3-container">
      <div class="w3-text-black">
        {# # important for href check, elsewise same url #}
        {% trans "Link"%}: <a type="text" href="#" id="nativelink"></a>
      </div>
      <div>
        {# # important for href check, elsewise same url #}
        <a href="#" class="w3-text-black" id="rawlink">{% trans "Raw" %}</a>
      </div>
      <a class="w3-text-black" style="display:none;" id="exportlink" href="">{% trans 'Export' %}</a>
    </div>
  </div>
</div>

<script type="text/javascript">
var nativelink = "{{nativelink}}";
var exportlink = "{{exportlink}}";
function open_qrmodal(){
  let _qrcanvas = document.getElementById('qrcanvas');
  let nativelink_link = document.getElementById('nativelink');
  let rawlink_link = document.getElementById('rawlink');
  let exportlink_link = document.getElementById('exportlink');
  if (nativelink_link.href != nativelink){
    if (nativelink.slice(-1)=="?"){
      rawlink_link.href = `${nativelink}raw=true`;
    } else {
      rawlink_link.href = `${nativelink}&raw=true`;
    }
    nativelink_link.href = nativelink;
    nativelink_link.text = nativelink;
    QRCode.toCanvas(
      _qrcanvas, nativelink, {  },
      function (error) {
        if (error)
          console.error(error)
      }
    )
  }
  if (exportlink != "" && exportlink_link.href != exportlink){
    exportlink_link.href = exportlink;
    exportlink_link.style.display = "block";
  } else {
    exportlink_link.style.display = "none";
  }
  document.getElementById('qrpresenter').style.display='block';
}


function close_qrmodal(){
  document.getElementById('qrpresenter').style.display='none'
}
</script>
