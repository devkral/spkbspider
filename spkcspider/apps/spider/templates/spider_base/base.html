{% load i18n %}
{% load staticfiles spider_base %}
{% load flatpages %}
<!DOCTYPE html>
<html lang="{{LANGUAGE_CODE}}">
  <head>
    <title>{% block title %}{% endblock %}</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="application-name" content="spkcspider"/>
    {% if is_public_view %}
      {% block public_meta %}{% endblock %}
    {% else %}
      <meta http-equiv="cache-control" content="no-store, no-cache, must-revalidate"/>
      <meta http-equiv="expires" content="0">
      <meta name="robots" content="noindex,nofollow,noarchive">
    {% endif %}

    <meta name="viewport" content="{% block viewport %}width=device-width, initial-scale=1.0{% endblock %}">

    {% block favicon %}
    <link rel="shortcut icon" type="image/svg" href="{% static 'spider_base/favicon.svg' %}" />
    {% endblock %}
    {# CSS for all pages #}
    {% block base_styles %}
    <link rel="stylesheet" href="{% static 'node_modules/w3-css/w3.css' %}">
    <link rel="stylesheet" href="{% static 'spidercss.css' %}">
    <link rel="stylesheet" href="{% static 'node_modules/@fortawesome/fontawesome-free/css/all.min.css' %}">
    {% endblock %}
    {# CSS for page #}
    {% block styles %}{% endblock %}
    {# form scripts and foo #}
    {% block extrahead %}{% endblock %}
  </head>

  <body class="bodyflex {% block body_class %}{% endblock %}">
    {# Deco content, e.g.base.html  #}
    {% block layout %}
      {% block headerbar %}
      <header class="cond-top-fix">
        <div class="w3-bar w3-black">
        <a class="w3-bar-item w3-button" href="{% url 'home' %}">
          <i class="fas fa-home" aria-hidden="true"></i>
        </a>
        {% url 'auth:login' as loginpath %}
        {% if SETTINGS.OPEN_FOR_REGISTRATION %}
          {% url 'auth:signup' as registerpath %}
        {% endif %}
        {% if request.user.is_authenticated %}
          <div style="margin-left:15px" class="w3-dropdown-hover w3-dropdown-click">
            <button onclick='document.getElementById("context_actions_list").classList.toggle("w3-show")' class="w3-button">
            <i class="fas fa-bars" aria-hidden="true"></i>
            <span class="w3-hide-small" style="margin-left:10px">Actions</span>
            <i class="fas fa-caret-down" style="margin-left:5px" aria-hidden="true"></i>
            </button>
            <div class="w3-dropdown-content w3-bar-block w3-black" id="context_actions_list">
              <div class="w3-animate-opacity w3-black">
                {% block context_actions %}
                  <a class="w3-bar-item w3-button" href="{% url 'spider_base:ucomponent-create' %}">
                    <i class="fas fa-plus-circle" style="margin-right:10px" aria-hidden="true"></i>
                    {% trans 'Add Component' %}
                  </a>
                  <a class="w3-bar-item w3-button" href="{% url 'spider_base:ucomponent-listpublic' %}">
                    <i class="fas fa-globe" style="margin-right:10px" aria-hidden="true"></i>
                    {% trans 'Public Components' %}
                  </a>
                  <a class="w3-bar-item w3-button" href="{% url 'spider_base:ucomponent-list' %}">
                    <i class="fas fa-sitemap" style="margin-right:10px" aria-hidden="true"></i>
                    {% trans 'Own Components' %}
                  </a>
                  <a class="w3-bar-item w3-button" href="{% list_own_content %}">
                    <i class="fas fa-folder" style="margin-right:10px;color:#FF0000;" aria-hidden="true"></i>
                    {% trans 'Private Contents' %}
                  </a>
                {% endblock context_actions %}
              </div>
            </div>
          </div>
          <div class="w3-right w3-dropdown-hover w3-dropdown-click w3-black">
            <button onclick='document.getElementById("user_actions_list").classList.toggle("w3-show")' class="w3-button w3-black">
              <i class="fas fa-user" style="margin-right:10px" aria-hidden="true"></i>
              <small class="w3-hide-small">{{request.user.username}}</small>
              <small class="w3-hide-medium w3-hide-large">{{request.user.username|truncatechars:10}}</small>
              <i class="fas fa-caret-down" style="margin-left:5px" aria-hidden="true"></i>
            </button>
            <div class="w3-dropdown-content w3-bar-block w3-black" style="right:0px" id="user_actions_list">
              <div class="w3-animate-opacity w3-black">
                {% block user_actions %}
                <a class="w3-bar-item w3-button w3-black" href="{% url 'auth:profile' %}">
                  <i class="fas fa-user-edit" style="margin-right:10px" aria-hidden="true"></i>
                  {% trans 'Profile' %}
                </a>
                <a class="w3-bar-item w3-button" href="{% update_component 'index' %}">
                  <i class="fas fa-lock" style="margin-right:10px" aria-hidden="true"></i>
                  {% trans 'Security' %}
                </a>
                {% if request.user.is_superuser or request.user.is_staff %}
                  <a class="w3-bar-item w3-button" href="{% url 'admin:index' %}">
                    <i class="fas fa-toolbox" style="margin-right:10px" aria-hidden="true"></i>
                    {% trans 'Admin' %}
                  </a>
                {% endif %}
                <a class="w3-bar-item w3-button w3-black" href="{% url 'auth:logout'%}">
                  <i class="fas fa-sign-out-alt" style="margin-right:10px" aria-hidden="true"></i>
                  {% trans 'Logout' %}
                </a>
                {% endblock user_actions %}
              </div>
            </div>
          </div>
        {% else %}
          {% if SETTINGS.OPEN_FOR_REGISTRATION %}
          <a class="w3-bar-item w3-button w3-right" href="{{registerpath}}{% if registerpath != request.path %}?next={{request.path|urlencode}}{% endif %}">
            <i class="fas fa-user-plus" style="margin-right:10px" aria-hidden="true"></i>
            {% trans 'Register' %}
          </a>
          {% endif %}
          {% if request.path != loginpath %}
            <a class="w3-bar-item w3-button w3-right" href="{{loginpath}}?next={{request.path|urlencode}}">
              <i class="fas fa-sign-in-alt" style="margin-right:10px" aria-hidden="true"></i>
              {% trans 'Login' %}
            </a>
          {% endif %}
        {% endif %}
        </div>
      </header>
      {% endblock headerbar %}
      <main class="footer-fix cond-top-fix{% block main_classes %}{% endblock %}" id="content-main" {% block main_attributes %}{% endblock %}>
      {% block messages %}
        {% if messages %}
          <ul class="messagelist w3-ul w3-padding">{% for message in messages %}
            <li class="{% if message.tags %}{{ message.tags }}{% endif %} {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}w3-red{% elif message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}w3-green{% elif message.level == DEFAULT_MESSAGE_LEVELS.WARNING %}w3-orange{% else %}w3-blue{% endif %}">{{ message|capfirst }}</li>
          {% endfor %}</ul>
        {% endif %}
      {% endblock messages %}
      {# Main content  #}
      {% block content %}{% endblock %}
    </main>
    {% block global_footer %}
    {% concat_string '/' LANGUAGE_CODE '/gfooter/' as global_footer_localized %}
    {% get_flatpages global_footer_localized for request.user as footer_pages %}
    {% if not footer_pages %}
      {% get_flatpages '/gfooter/' for request.user as footer_pages %}
    {% endif %}
    {% if footer_pages %}
    <footer style="border-top: 2px solid #aaa;">
      <div class="w3-red w3-row w3-padding">
        {% for page in footer_pages %}
          <div class="w3-padding w3-col s12 m4">
            <a href="{{page.url}}">{{page.title}}</a>
          </div>
        {% endfor %}
      </div>
    </footer>
    {% endif %}
    {% endblock %}
    {% endblock %}

    {# Main scripts #}
    {% block base_scripts %}{% endblock %}

    {# Scripts #}
    {% block scripts %}{% endblock %}

    {# e.g. modals #}
    {% block outercontent %}{% endblock %}

  </body>
</html>
